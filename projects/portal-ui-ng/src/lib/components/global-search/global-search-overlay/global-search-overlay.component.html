<div cdkTrapFocus [cdkTrapFocusAutoCapture]="true" class="pui-global-search">
  <pui-input-field>
    <i>search</i>
    <input
      placeholder="Type to search"
      cdkFocusInitial
      (input)="onSearchInput($event)">
  </pui-input-field>
  <pui-divider></pui-divider>
  <div class="pui-global-search__results-wrapper">
    @if (searchResults(); as results) {
      <div class="pui-global-search__results">
        @for (suggestion of results.best; track $index) {
          <ng-container [ngTemplateOutlet]="item" [ngTemplateOutletContext]="{ $implicit: suggestion }"></ng-container>
        } @empty {
          <div class="pui-global-search__empty">No results</div>
        }
      </div>
      @for (category of results.categories; track category.category) {
        <div class="pui-global-search__results">
          <div class="pui-global-search__category">
            {{ category.category }}
          </div>
          @for (suggestion of category.list; track $index) {
            <ng-container [ngTemplateOutlet]="item" [ngTemplateOutletContext]="{ $implicit: suggestion }"></ng-container>
          }
        </div>
      }
    }
  </div>
</div>

<ng-template #item let-suggestion>
  <button
    #result
    class="pui-global-search__result"
    [attr.data-selected]="selectedElement?.nativeElement == result"
    puiHoverable
    type="button"
    (click)="onSelectSuggestion(suggestion)"
  >
    <div class="pui-global-search__result__icon">
      @if (suggestion.icon) {
        <i>{{ suggestion.icon }}</i>
      } @else if (suggestion.iconComponent) {
        <ng-container [ngComponentOutlet]="suggestion.iconComponent"></ng-container>
      }
    </div>
    <div class="pui-global-search__result__text">
      <p class="pui-global-search__result__text-title" [innerHTML]="suggestion.title"></p>
      @if (suggestion.description) {
        <p class="pui-global-search__result__text-description" [innerHTML]="suggestion.description"></p>
      }
    </div>
  </button>
</ng-template>