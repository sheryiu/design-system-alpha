<button
  #button
  pheadHoverable
  [hoverableEnabled]="sortDirective?.templateRef || filterDirective?.templateRef"
  [attr.data-overlay]="overlayRef != null"
  [attr.data-justify-end]="rightAligned"
  (click)="openFilter(button)"
>
  <ng-content></ng-content>
  @if (sortDirective?.templateRef || filterDirective?.templateRef) {
    <div class="phead-table-header-cell__gap"><!-- placeholder --></div>
    @if (!filtered && !sortedAsc && !sortedDesc) {
      <i>arrow_drop_down</i>
    } @else {
      <div class="phead-table-header-cell__state">
        @if (filtered) {
          <div class="phead-table-header-cell__state__active">
            <i>filter_alt</i>
          </div>
        }
        @if (sortedAsc) {
          <div class="phead-table-header-cell__state__active">
            <i class="phead-table-header-cell__sort-asc">sort</i>
          </div>
        } @else if (sortedDesc) {
          <div class="phead-table-header-cell__state__active">
            <i>sort</i>
          </div>
        }
      </div>
    }
  }
</button>
<ng-template #filterPopup>
  <div class="phead-table-header-cell-overlay">
    @if (sortDirective?.templateRef) {
      <ng-container [ngTemplateOutlet]="sortDirective!.templateRef"></ng-container>
    }
    @if (sortDirective?.templateRef && filterDirective?.templateRef) {
      <phead-divider></phead-divider>
    }
    @if (filterDirective?.templateRef) {
      <ng-container [ngTemplateOutlet]="filterDirective!.templateRef"></ng-container>
    }
  </div>
</ng-template>