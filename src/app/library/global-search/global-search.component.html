<div cdkTrapFocus [cdkTrapFocusAutoCapture]="true" class="core-global-search-backdrop" (click)="close()">
  <button
    class="rounded-3 aspect-square self-center shrink-0"
    style="grid-area: button"
    [style.marginTop.px]="originPosition.top"
    [style.marginLeft.px]="originPosition.left"
    [style.width.px]="originPosition.width"
    [style.height.px]="originPosition.height"
    coreHoverable
    coreHardSurface
    color="gray"
    (click)="close()"
  >
    <i class="icon-6">arrow_back</i>
  </button>
  <div
    class="grow border rounded-3 shadow-lg overflow-hidden bg-primary-200 dark:bg-lunar-green-800"
    style="grid-area: input"
    (click)="$event.stopPropagation()"
    [style.marginTop.px]="originPosition.top"
    [style.marginRight.px]="originPosition.left"
  >
    <input
      class="w-full h-full px-6 py-1 text-xl"
      placeholder="Type to search"
      coreInputField
      cdkFocusInitial
      (input)="onSearchInput($event)">
  </div>
  <div
    style="grid-area: empty"
  ><!-- placeholder --></div>
  @if (searchResults$ | async; as results) {
    <div
      style="grid-area: results"
    >
      <!-- item results -->
      <div class="grow flex flex-col items-stretch">
        <div class="flex flex-col">
          @for (result of results; track $index) {
            <a
              class="px-4 py-3 rounded-3"
              coreHoverable
              [routerLink]="result.item.routerLink"
              [queryParams]="result.item.routerLinkOptions?.queryParams"
              [queryParamsHandling]="result.item.routerLinkOptions?.queryParamsHandling"
              [fragment]="result.item.routerLinkOptions?.fragment"
              [preserveFragment]="result.item.routerLinkOptions?.preserveFragment"
              [relativeTo]="rootRoute"
            >
              <div class="w-full flex gap-4 items-center">
                @if (result.item.icon) {
                  <i class="icon-6">{{ result.item.icon }}</i>
                } @else {
                  <div class="size-6"><!-- placeholder --></div>
                }
                <div class="flex flex-col gap-1">
                  <p class="text-xl font-medium">{{ result.item.title }}</p>
                  @if (result.item.description) {
                    <p class="text-secondary">{{ result.item.description }}</p>
                  }
                </div>
              </div>
            </a>
            @if (!$last) {
              <div class="border-b mx-3"></div>
            }
          }
        </div>
      </div>
    </div>
  }
  @if (actions$ | async; as actions) {
    <div
      class="md:w-96 grid grid-cols-2 auto-rows-max gap-4"
      style="grid-area: actions"
      [style.marginRight.px]="originPosition.left"
    >
      @for (action of actions; track $index) {
        <button
          class="rounded-3 min-h-24 px-2 py-3 flex-col"
          coreHoverable
          coreHardSurface
          color="gray"
          (click)="onActionClick(action.item)"
        >
          @if (action.item.options?.icon) {
            <i class="icon-8 font-variation-weight-light text-secondary mb-2">{{ action.item.options?.icon }}</i>
          }
          <p class="text-xl font-bold">{{ action.item.title }}</p>
          @if (action.item.options?.description) {
            <p>{{ action.item.options?.description }}</p>
          }
        </button>
      }
    </div>
  }
</div>