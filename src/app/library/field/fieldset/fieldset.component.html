<form class="@container/fieldset">
  <div class="core-fieldset" (click)="onTouched?.()" [formGroup]="form">
    @for (fieldDef of fieldDefs; track fieldDef.key) {
      <div class="core-fieldset__label">
        <label [for]="fieldDef.key">{{ fieldDef.label }}</label>
        <span class="core-fieldset__label__type">{{ fieldDef.fieldType }}</span>
      </div>
      <div class="core-fieldset__input">
        @if (form.controls[fieldDef.key] && form.controls[fieldDef.key].value == null) {
          <div
            class="core-fieldset__input-field"
          >
            <button
              coreHoverable
              coreHardSurface
              color="accent"
              (click)="onSetNotNull(fieldDef)"
            >Add</button>
            <span class="text-secondary px-2 leading-8">null</span>
          </div>
        } @else {
          @switch (fieldDef.fieldType) {
            @case ('string') {
            <div
              class="core-fieldset__input-field"
            >
              <input
                [id]="fieldDef.key"
                coreInputField
                type="text"
                class="size-full min-h-8 px-2 py-0.5"
                [formControlName]="fieldDef.key"
                (input)="handleInput()"
                coreAutocompleteTrigger
                [autocompleteEnabled]="fieldDef.fieldConfig?.enum != null"
                [autocompleteValues]="fieldDef.fieldConfig?.enum"
                [autocompleteTemplateRef]="enumAutocomplete"
                (autocompleteChange)="onAutocomplete(fieldDef, $event)"
              />
            </div>
            }
            @case ('number') {
            <div
              class="core-fieldset__input-field"
            >
              <input
                [id]="fieldDef.key"
                coreInputField
                type="number"
                class="size-full min-h-8 px-2 py-0.5"
                [formControlName]="fieldDef.key"
                (input)="handleInput()"
                coreAutocompleteTrigger
                [autocompleteEnabled]="fieldDef.fieldConfig?.enum != null"
                [autocompleteValues]="fieldDef.fieldConfig?.enum"
                [autocompleteTemplateRef]="enumAutocomplete"
                (autocompleteChange)="onAutocomplete(fieldDef, $event)"
              />
            </div>
            }
            @default {
            <div>Unsupported Type</div>
            }
          }
          <button
            coreHoverable
            coreHardSurface
            color="accent"
            (click)="onSetNull(fieldDef)"
          >
            <i class="icon-4">remove</i>
          </button>
        }
      </div>
    }
  </div>
</form>

<ng-template #enumAutocomplete let-item>
  {{ item }}
</ng-template>